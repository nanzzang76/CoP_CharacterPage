<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Characters</title>
    <link rel="stylesheet" href="./css/reset.css" />
    <link rel="stylesheet" href="./css/style.css" />
  </head>
  <body>
    <div id="wrap">
      <div class="menu">
        <div class="menu_img">
          <img
            src="./img/all/byeol1.png"
            alt="귀여운 아기고양이 별이 눈을 감고 고개를 빠르게 돌리고 있다"
          />
        </div>
        <div class="menu_edward">
          <button onclick="location.href='index.html'">에드워드 엘릭</button>
        </div>

        <div class="menu_rocklee">
          <button onclick="location.href='rocklee.html'">록리</button>
        </div>

        <div class="menu_taeseop">
          <button onclick="location.href='taeseop.html'">송태섭</button>
        </div>

        <div class="menu_taeyoung">
          <button onclick="location.href='taeyoung.html'">권태영</button>
        </div>
      </div>

      <!-- 1페이지 -->
      <section class="page1">
        <div class="answer">
          <p></p>
        </div>

        <figure class="leaf1">
          <img src="./img/rocklee/leaf.png" alt="" />
        </figure>

        <figure class="leaf2">
          <img src="./img/rocklee/leaf.png" alt="" />
        </figure>

        <figure class="leaf3">
          <img src="./img/rocklee/leaf.png" alt="" />
        </figure>

        <figure class="leaf4">
          <img src="./img/rocklee/leaf.png" alt="" />
        </figure>

        <figure class="character1">
          <img src="./img/rocklee/rocklee1.png" alt="" />
        </figure>

        <figure class="star1">
          <img src="./img/all/Star1.png" alt="" />
        </figure>

        <figure class="star2">
          <img src="./img/all/Star2.png" alt="" />
        </figure>

        <div class="description">
          <p class="text1">부활한, 나뭇잎 마을의 아름다운 푸른 야수...</p>
          <figure class="text2">
            <img src="./img/rocklee/록 리다!.png" alt="" />
          </figure>
        </div>

        <div class="speechbubble">
          <figure>
            <img src="./img/all/speechbubble.png" alt="" />
          </figure>
          <p class="text3">헉 멋지다!!!</p>
          <p class="text4">
            나도 록리처럼 <br />
            수련해야겠어;
          </p>
        </div>

        <div class="mama">
          <figure class="star3">
            <img src="./img/all/Star3.png" alt="" />
          </figure>
          <p>
            엄마 <br />
            전 <span class="bold">닌자</span>가 될래요!
          </p>
        </div>
        <div class="approved">
          <img src="./img/all/approved.png" alt="" />
        </div>
      </section>

      <figure class="sandbag">
        <img src="./img/rocklee/sandbag.png" alt="" />
      </figure>

      <div class="track_wrapper">
        <div class="track">
          <div class="track1">
            <span
              >Rock Lee Rock Lee Rock Lee Rock Lee Rock Lee Rock Lee Rock Lee
              Rock Lee Rock Lee Rock Lee Rock Lee Rock Lee
            </span>
            <span
              >Rock Lee Rock Lee Rock Lee Rock Lee Rock Lee Rock Lee Rock Lee
              Rock Lee Rock Lee Rock Lee Rock Lee Rock Lee
            </span>
          </div>
          <div class="track2">
            <span
              >Rock Lee Rock Lee Rock Lee Rock Lee Rock Lee Rock Lee Rock Lee
              Rock Lee Rock Lee Rock Lee Rock Lee Rock Lee
            </span>
            <span
              >Rock Lee Rock Lee Rock Lee Rock Lee Rock Lee Rock Lee Rock Lee
              Rock Lee Rock Lee Rock Lee Rock Lee Rock Lee
            </span>
          </div>
        </div>
      </div>

      <div class="orange"></div>

      <!-- 2페이지 -->
      <section class="page2">
        <div class="megadescription1">
          <p class="text5">
            <span>노력의 천재</span>
            <span>흔들리지 않는 근성</span>
            <span>넘어짐 속의 성장</span>
            <span>불가능을 밀어붙이는 의지</span>
            <span>땀으로 쌓아올린 실력</span>
            <span>무너져도 다시 일어서는 용기</span>
            <span>천재를 뛰어넘는 끈기</span>
          </p>
        </div>

        <div class="megadiscription2">
          <p class="text6">
            <span>비웃음을 딛는 자존심</span>
            <span>좌절 끝의 희망</span>
            <span>가르침을 믿는 신념</span>
            <span>자신을 이겨낸 하루</span>
            <span>오늘을 이긴 자의 내일</span>
            <span>끝을 모르는 단련</span>
            <span>평범함의 위대함</span>
          </p>
        </div>

        <div>
          <button class="clickme">
            <img src="./img/all/clickme.png" alt="" />
          </button>
        </div>

        <div class="clickthat">
          <p>클릭해보세요! ▶</p>
        </div>

        <figure class="sparkle1">
          <img src="./img/all/sparkle.png" alt="" />
        </figure>

        <figure class="sparkle2">
          <img src="./img/all/sparkle.png" alt="" />
        </figure>

        <figure class="cloud">
          <img src="./img/all/cloud.png" alt="" />
        </figure>

        <figure class="rocklee2">
          <img src="./img/rocklee/rocklee2.png" alt="" />
        </figure>
        <figure class="rocklee_shadow1">
          <img src="./img/rocklee/rocklee_shadow1.png" alt="" />
        </figure>
        <figure class="rocklee_shadow2">
          <img src="./img/rocklee/rocklee_shadow2.png" alt="" />
        </figure>

        <figure class="rocklee_text">
          <img src="./img/rocklee/RockLee.png" alt="" />
        </figure>

        <div class="jolryeol_leaf">
          <img src="./img/rocklee/naruto.png" alt="졸렬잎마을 심볼" />
          <img src="./img/rocklee/naruto.png" alt="졸렬잎마을 심볼" />
          <img src="./img/rocklee/naruto.png" alt="졸렬잎마을 심볼" />
          <img src="./img/rocklee/naruto.png" alt="졸렬잎마을 심볼" />
          <img src="./img/rocklee/naruto.png" alt="졸렬잎마을 심볼" />
          <img src="./img/rocklee/naruto.png" alt="졸렬잎마을 심볼" />
          <img src="./img/rocklee/naruto.png" alt="졸렬잎마을 심볼" />
          <img src="./img/rocklee/naruto.png" alt="졸렬잎마을 심볼" />
          <img src="./img/rocklee/naruto.png" alt="졸렬잎마을 심볼" />
          <img src="./img/rocklee/naruto.png" alt="졸렬잎마을 심볼" />
          <img src="./img/rocklee/naruto.png" alt="졸렬잎마을 심볼" />
          <img src="./img/rocklee/naruto.png" alt="졸렬잎마을 심볼" />
          <img src="./img/rocklee/naruto.png" alt="졸렬잎마을 심볼" />
        </div>
      </section>

      <!-- 3페이지 -->
      <section class="page3">
        <div class="curtain">
          <img src="./img/all/theater.jpg" alt="" />
        </div>

        <div class="tada">
          <p>오늘의 명장면</p>
        </div>

        <figure class="ribbon">
          <img src="./img/all/ribbon.png" alt="" />
        </figure>

        <figure class="frame1">
          <img src="./img/all/frame.png" alt="" />
        </figure>

        <figure class="randomImage"></figure>

        <div class="tada_btn">
          <button class="show-image">나와라 뚝딱</button>
        </div>

        <div class="fighting">
          <div class="fighting-wrap">
            <p></p>
            <figure>
              <img src="./img/all/Star1.png" alt="" />
            </figure>
          </div>
        </div>
      </section>
    </div>

    <!-- 4페이지 -->
    <div class="page4-bg">
      <section class="page4">
        <h2>방명록</h2>
        <h4 class="caution">무조건적인 선플만 부탁드립니다.</h4>
        <ul id="comment-list"></ul>
        <div id="pagination" style="text-align: center; margin: 20px 0"></div>

        <input type="text" id="nickname" placeholder="닉네임" />
        <input type="text" id="new-comment" placeholder="댓글 입력" />
        <button onclick="submitComment()">등록</button>

        <div id="admin-login" style="text-align: right; margin-top: 20px">
          <input
            type="password"
            id="admin-pass"
            placeholder="관리자 비밀번호 입력"
            style="padding: 5px"
          />
          <button onclick="verifyAdmin()" style="padding: 5px 10px">
            확인
          </button>
        </div>

        <script type="module">
          import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
          import {
            getFirestore,
            collection,
            addDoc,
            getDocs,
            deleteDoc,
            doc,
            serverTimestamp,
            query,
            orderBy,
          } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

          const firebaseConfig = {
            apiKey: "AIzaSyAkWZK2xR08tX86yAe_uD-ThAFhZoCrGyc",
            authDomain: "character-comments.firebaseapp.com",
            projectId: "character-comments",
            storageBucket: "character-comments.firebasestorage.app",
            messagingSenderId: "774340467705",
            appId: "1:774340467705:web:1e32673cbf86212868fb28",
            measurementId: "G-W3SY3JL2KM",
          };

          const app = initializeApp(firebaseConfig);
          const db = getFirestore(app);

          let isAdmin = false;
          let allComments = [];
          let currentPage = 1;
          const commentsPerPage = 5;

          window.verifyAdmin = function () {
            const input = document.getElementById("admin-pass").value;
            if (input === "486") {
              isAdmin = true;
              alert("관리자 모드가 활성화되었습니다!");
              renderComments();
              renderPagination();
            } else {
              alert("비밀번호가 틀렸습니다.");
            }
          };

          window.submitComment = async function () {
            const nickname = document.getElementById("nickname").value.trim();
            const content = document.getElementById("new-comment").value.trim();
            if (!nickname || !content) {
              return alert("닉네임과 댓글을 모두 입력해 주세요!");
            }

            await addDoc(collection(db, "comments"), {
              nickname,
              content,
              timestamp: serverTimestamp(),
            });

            document.getElementById("nickname").value = "";
            document.getElementById("new-comment").value = "";
            await fetchComments();
          };

          async function fetchComments() {
            const q = query(
              collection(db, "comments"),
              orderBy("timestamp", "desc")
            );
            const querySnapshot = await getDocs(q);
            allComments = [];
            querySnapshot.forEach((docSnap) => {
              allComments.push({ id: docSnap.id, ...docSnap.data() });
            });
            renderComments();
            renderPagination();
          }

          function renderComments() {
            const list = document.getElementById("comment-list");
            list.innerHTML = "";

            const startIdx = (currentPage - 1) * commentsPerPage;
            const pageComments = allComments.slice(
              startIdx,
              startIdx + commentsPerPage
            );

            pageComments.forEach((comment) => {
              const li = document.createElement("li");
              let content = `[${new Date(
                comment.timestamp?.toDate()
              ).toLocaleString()}] <strong>${comment.nickname}</strong>: ${
                comment.content
              }`;
              if (isAdmin) {
                content += ` <span class="delete-btn" data-id="${comment.id}" style="color: red; cursor: pointer; margin-left: 10px;">❌</span>`;
              }
              li.innerHTML = content;
              list.appendChild(li);
            });
          }

          function renderPagination() {
            const pagination = document.getElementById("pagination");
            pagination.innerHTML = "";

            const totalPages = Math.ceil(allComments.length / commentsPerPage);
            if (totalPages <= 1) return;

            const groupSize = 5;
            const currentGroup = Math.ceil(currentPage / groupSize);
            const startPage = (currentGroup - 1) * groupSize + 1;
            const endPage = Math.min(startPage + groupSize - 1, totalPages);

            const addBtn = (label, page, disabled = false) => {
              const btn = document.createElement("button");
              btn.textContent = label;
              btn.disabled = disabled;
              btn.style.margin = "0 4px";
              btn.onclick = () => {
                currentPage = page;
                renderComments();
                renderPagination();
              };
              pagination.appendChild(btn);
            };

            addBtn("<<", 1, currentPage === 1);
            addBtn("<", currentPage - 1, currentPage === 1);
            for (let i = startPage; i <= endPage; i++) {
              addBtn(i, i, i === currentPage);
            }
            addBtn(">", currentPage + 1, currentPage === totalPages);
            addBtn(">>", totalPages, currentPage === totalPages);
          }

          document.addEventListener("click", async (e) => {
            if (e.target.classList.contains("delete-btn")) {
              const docId = e.target.dataset.id;
              const sure = confirm("정말 이 댓글을 삭제하시겠습니까?");
              if (sure) {
                await deleteDoc(doc(db, "comments", docId));
                await fetchComments();
              }
            }
          });

          window.addEventListener("DOMContentLoaded", fetchComments);
        </script>
      </section>
    </div>

    <section class="footer">
      <div class="footer_wrap">
        <p class="copyright">
          Fan-made page (2025) <br />
          Zero copyright powers here — all the cool stuff belongs to the
          original geniuses.
        </p>
        <div class="awesome">
          <p class="great">명작 모음</p>
          <div class="masterpiece">
            <p>
              <a
                href="https://product.kyobobook.co.kr/detail/S000216290235"
                target="_blank"
                >강철의 연금술사</a
              >
            </p>
            <p>
              <a
                href="https://product.kyobobook.co.kr/detail/S000001713510"
                target="_blank"
                >나루토</a
              >
            </p>
            <p>
              <a
                href="https://product.kyobobook.co.kr/detail/S000001695143"
                target="_blank"
                >슬램덩크</a
              >
            </p>
            <p>
              <a
                href="https://product.kyobobook.co.kr/detail/S000200185130"
                target="_blank"
                >격기3반</a
              >
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- 팝업 -->
    <!-- 팝업 구조 -->
    <div class="layer-popup">
      <div class="layer-popup-wrap">
        <div class="popup-title">
          <img src="./img/all/ribbon2.png" alt="" />
          <p>안녕하세요! 반갑습니다.</p>
        </div>

        <div class="blahblah">
          <div class="byeol_description">
            <figure class="popup_byeol">
              <img src="./img/all/byeol2.png" alt="" />
            </figure>
            <p>귀엽고 깜찍한 아기 고양이 정 별(2015년 생)</p>
          </div>

          <div class="popup-content">
            <p>만든 이: 정혜민</p>
            <p class="info">
              신상:<br />
              <strong>1997.07.01. 오전 11시 05분</strong><br />
              <span class="small">위 정보로 사주를 볼 시 제게도 알려주세요</span
              ><br />
              하동정씨 / O형 (RH+)
            </p>
            <p class="hobby">취미:<br />누워서 만화 보기</p>
          </div>
          <div class="popup-buttons">
            <button class="hello-btn">
              <img src="./img/all/beautiful-btn.png" alt="" />
            </button>
            <button class="poo-btn">
              <img src="./img/all/ignore-btn.png" alt="" />
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- 탑버튼 -->
    <button id="topBtn">
      <img src="./img/all/top.png" alt="Top 버튼" />
    </button>

    <script>
      // 록리등장
      document.addEventListener("DOMContentLoaded", function () {
        const clickMeBtn = document.querySelector(".clickme");
        const rocklee2 = document.querySelector(".rocklee2");
        const rockleeShadow1 = document.querySelector(".rocklee_shadow1");
        const rockleeShadow2 = document.querySelector(".rocklee_shadow2");
        const cloud = document.querySelector(".cloud");
        const rockleeText = document.querySelector(".rocklee_text");

        clickMeBtn.addEventListener("click", function () {
          console.log("clicked!"); // 실행 확인용

          [rocklee2, cloud].forEach((el) => {
            el.style.animation = "shoot 0.5s forwards";
          });

          rockleeShadow1.style.animation = "shoot 0.5s 0.2s forwards";
          rockleeShadow2.style.animation = "shoot 0.5s 0.4s forwards";

          // rocklee_text
          if (rockleeText) {
            console.log("rocklee_text found!");
            rockleeText.style.opacity = "1";
          } else {
            console.log("rocklee_text NOT found!");
          }
        });
      });

      // 랜덤 이미지 기능
      const imageData = [
        {
          path: "./img/rocklee/random/img1.png",
          text: "재능이 없더라도<br>훌륭한 닌자가 될 수 있어!",
        },
        {
          path: "./img/rocklee/random/img2.png",
          text: "어이어이 록리! <br>제5두문까지 열어버린 거냐구-!",
        },
        {
          path: "./img/rocklee/random/img3.png",
          text: "닌자의 길이란<br>정말 멋진 거구나...!",
        },
        {
          path: "./img/rocklee/random/img4.png",
          text: "쓰레기!쓰레기!",
        },
        {
          path: "./img/rocklee/random/img5.png",
          text: "노력으로<br>이겨내자!!",
        },
        {
          path: "./img/rocklee/random/img6.png",
          text: "건치미소 멋지다!",
        },
        {
          path: "./img/rocklee/random/img7.png",
          text: "나도 기쁘구나!",
        },
      ];

      let lastIndex = -1;

      document
        .querySelector(".show-image")
        .addEventListener("click", function () {
          let randomIndex;

          do {
            randomIndex = Math.floor(Math.random() * imageData.length);
          } while (randomIndex === lastIndex); // 중복 방지

          lastIndex = randomIndex;
          const selected = imageData[randomIndex];

          // 이미지 삽입
          const imgElement = document.createElement("img");
          imgElement.src = selected.path;
          imgElement.alt = "랜덤 이미지";
          imgElement.style.maxWidth = "100%";

          const figure = document.querySelector(".randomImage");
          figure.innerHTML = "";
          figure.appendChild(imgElement);

          // 텍스트 삽입
          const textTarget = document.querySelector(".fighting p");
          textTarget.innerHTML = selected.text;
        });
    </script>

    <script src="./js/common.js"></script>
  </body>
</html>
